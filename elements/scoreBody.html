<link rel="import" href="../app/components/polymer/polymer.html" />
<link rel="import" href="../app/components/core-ajax/core-ajax.html">
<link rel="import" href="scoreSettings.html" />
<link rel="import" href="scoreHeader.html" />
<link rel="import" href="scoreCanvas.html" />
<polymer-element name="smw-score-body" attributes="source">
    <template>
        <style>
            :host {
                border: solid 1px #EEE;
                display: block;
                height: 1100px;
                margin: 10px;
                padding: 20px;
                width: 850px;
            }
            :host(.landscape) {
                height: 850px;
                width: 1100px;
            }
        </style>
        <core-ajax
            id="scoreSource"
            url="{{ source }}"
            handleAs="json"
            on-core-response="{{ scoreReceived }}">
        </core-ajax>
        <smw-score-settings id="globalSettings"></smw-score-settings>
        <smw-score-header id="scoreHeader" data="{{ scoreData.header }}"></smw-score-header>
        <smw-score-canvas id="scoreCanvas" data="{{ scoreData.music }}" settings="{{ scoreSettings }}" width="{{ width }}"></smw-score-canvas>
    </template>
    <script>
        (function() {
            'use strict';
            Polymer('smw-score-body', {
                source: '',
                _setSettings: function(global, overrides) {
                    global.timeSignature = overrides.music.timeSignature;
                    return global;
                },
                sourceChanged: function() {
                    this.$.scoreSource.go();
                },
                scoreReceived: function(e) {
                    this.scoreData = e.detail.response;
                    this.scoreSettings = this._setSettings(this.$.globalSettings.settings, this.scoreData);
                    this.width = (this.scoreSettings.orientation === 'portrait') ? 850 : 1100;
                }
            });
        })();
    </script>
</polymer-element>
